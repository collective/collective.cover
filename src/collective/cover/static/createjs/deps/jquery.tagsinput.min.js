/*

	jQuery Tags Input Plugin 1.3.3
	
	Copyright (c) 2011 XOXCO, Inc
	
	Documentation for this plugin lives here:
	http://xoxco.com/clickable/jquery-tags-input
	
	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php

	ben@xoxco.com

*/(function(a){var b=new Array,c=new Array;a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),d=a(this).data("maxwidth"),e="",f=a(this),g=a("#"+a(this).data("tester_id"));if(e===(e=f.val()))return;var h=e.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");g.html(h);var i=g.width(),j=i+b.comfortZone>=c?i+b.comfortZone:c,k=f.width(),l=j<k&&j>=c||j>c&&j<d;l&&f.width(j)},a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width(),d=a(this).data("maxwidth")||b.maxInputWidth||a(this).closest(".tagsinput").width()-b.inputPadding,e="",f=a(this),g=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";!a("#"+h).length>0&&(g.attr("id",h),g.appendTo("body")),f.data("minwidth",c),f.data("maxwidth",d),f.data("tester_id",h),f.css("width",c)},a.fn.addTag=function(d,e){return e=jQuery.extend({focus:!1,callback:!0},e),this.each(function(){var f=a(this).attr("id"),g=a(this).val().split(b[f]);g[0]==""&&(g=new Array),d=jQuery.trim(d);if(e.unique){var h=a(this).tagExist(d);h==1&&a("#"+f+"_tag").addClass("not_valid")}else var h=!1;if(d!=""&&h!=1){a("<span>").addClass("tag").append(a("<span>").text(d).append("&nbsp;&nbsp;"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+f).removeTag(escape(d))})).insertBefore("#"+f+"_addTag"),g.push(d),a("#"+f+"_tag").val(""),e.focus?a("#"+f+"_tag").focus():a("#"+f+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,g);if(e.callback&&c[f]&&c[f].onAddTag){var i=c[f].onAddTag;i.call(this,d)}if(c[f]&&c[f].onChange){var j=g.length,i=c[f].onChange;i.call(this,a(this),g[j-1])}}}),!1},a.fn.removeTag=function(d){return d=unescape(d),this.each(function(){var e=a(this).attr("id"),f=a(this).val().split(b[e]);a("#"+e+"_tagsinput .tag").remove(),str="";for(i=0;i<f.length;i++)f[i]!=d&&(str=str+b[e]+f[i]);a.fn.tagsInput.importTags(this,str);if(c[e]&&c[e].onRemoveTag){var g=c[e].onRemoveTag;g.call(this,d)}}),!1},a.fn.tagExist=function(c){var d=a(this).attr("id"),e=a(this).val().split(b[d]);return jQuery.inArray(c,e)>=0},a.fn.importTags=function(b){id=a(this).attr("id"),a("#"+id+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)},a.fn.tagsInput=function(d){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);return this.each(function(){e.hide&&a(this).hide();var d=a(this).attr("id");if(!d||b[a(this).attr("id")])d=a(this).attr("id","tags"+(new Date).getTime()).attr("id");var f=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},e);b[d]=f.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)c[d]=new Array,c[d].onAddTag=e.onAddTag,c[d].onRemoveTag=e.onRemoveTag,c[d].onChange=e.onChange;var g='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';e.interactive&&(g=g+'<input id="'+d+'_tag" value="" data-default="'+e.defaultText+'" />'),g+='</div><div class="tags_clear"></div></div>',a(g).insertAfter(this),a(f.holder).css("width",e.width),a(f.holder).css("min-height",e.height),a(f.holder).css("height","100%"),a(f.real_input).val()!=""&&a.fn.tagsInput.importTags(a(f.real_input),a(f.real_input).val());if(e.interactive){a(f.fake_input).val(a(f.fake_input).attr("data-default")),a(f.fake_input).css("color",e.placeholderColor),a(f.fake_input).resetAutosize(e),a(f.holder).bind("click",f,function(b){a(b.data.fake_input).focus()}),a(f.fake_input).bind("focus",f,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&a(b.data.fake_input).val(""),a(b.data.fake_input).css("color","#000000")});if(e.autocomplete_url!=undefined){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];jQuery.Autocompleter!==undefined?(a(f.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),a(f.fake_input).bind("result",f,function(b,c,f){c&&a("#"+d).addTag(c[0]+"",{focus:!0,unique:e.unique})})):jQuery.ui.autocomplete!==undefined&&(a(f.fake_input).autocomplete(autocomplete_options),a(f.fake_input).bind("autocompleteselect",f,function(b,c){return a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:e.unique}),!1}))}else a(f.fake_input).bind("blur",f,function(b){var c=a(this).attr("data-default");return a(b.data.fake_input).val()!=""&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",e.placeholderColor)),!1});a(f.fake_input).bind("keypress",f,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||b.which==13)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}),a(b.data.fake_input).resetAutosize(e),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(e)}),f.removeWithBackspace&&a(f.fake_input).bind("keydown",function(b){if(b.keyCode==8&&a(this).val()==""){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last").text(),d=a(this).attr("id").replace(/_tag$/,"");c=c.replace(/[\s]+x$/,""),a("#"+d).removeTag(escape(c)),a(this).trigger("focus")}}),a(f.fake_input).blur(),f.unique&&a(f.fake_input).keydown(function(b){(b.keyCode==8||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&a(this).removeClass("not_valid")})}}),this},a.fn.tagsInput.updateTagsField=function(c,d){var e=a(c).attr("id");a(c).val(d.join(b[e]))},a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id"),g=e.split(b[f]);for(i=0;i<g.length;i++)a(d).addTag(g[i],{focus:!1,callback:!1});if(c[f]&&c[f].onChange){var h=c[f].onChange;h.call(d,d,g[i])}}})(jQuery);